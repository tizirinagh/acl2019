<!DOCTYPE html>
<html>
<head>
<title>Data Programing for Learning Discourse Structure</title>
</head>
<body>
<h2><a href="index.html"><strong>Home page </a></strong></h2>



<h1 style="text-align: center;"> Result LF</h1>

<hr />

<p> <strong>Result</strong> connects a cause to its effect, i.e., the main eventuality of the first argument is understood to cause the eventuality given by the second.</p>

<h2 style="color:#505050">LL (linguistic source -> linguistic target)</h2>
<h3 style="color:#505050">Rule(s):</h3>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">LF_Result_L_L_case1</span>(row):
    l<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>
    <span style="color: #008800; font-weight: bold">if</span> (<span style="color: #007020">any</span>(x <span style="color: #000000; font-weight: bold">in</span> row<span style="color: #333333">.</span>target_text<span style="color: #333333">.</span>lower() <span style="color: #008800; font-weight: bold">for</span> x <span style="color: #000000; font-weight: bold">in</span> resultWords) 
                <span style="color: #000000; font-weight: bold">or</span> <span style="color: #007020">any</span>(x <span style="color: #000000; font-weight: bold">in</span> row<span style="color: #333333">.</span>source_text<span style="color: #333333">.</span>lower() <span style="color: #008800; font-weight: bold">for</span> x <span style="color: #000000; font-weight: bold">in</span> resultWords)):
            l<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">1</span>
    <span style="color: #008800; font-weight: bold">return</span> l


<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">LF_Result_L_L_case2</span>(row):
    l <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
    <span style="color: #008800; font-weight: bold">if</span> row<span style="color: #333333">.</span>source_surface_act <span style="color: #000000; font-weight: bold">in</span> [<span style="background-color: #fff0f0">&quot;Question&quot;</span>, <span style="background-color: #fff0f0">&quot;Request&quot;</span>, <span style="background-color: #fff0f0">&quot;Assertion&quot;</span>] \
    <span style="color: #000000; font-weight: bold">and</span> (row<span style="color: #333333">.</span>target_dialogue_act <span style="color: #000000; font-weight: bold">in</span> [<span style="background-color: #fff0f0">&quot;Offer&quot;</span>, <span style="background-color: #fff0f0">&quot;Counteroffer&quot;</span>] \
         <span style="color: #000000; font-weight: bold">or</span> row<span style="color: #333333">.</span>source_emitter <span style="color: #333333">==</span> row<span style="color: #333333">.</span>target_text<span style="color: #333333">.</span>partition(<span style="background-color: #fff0f0">&#39; &#39;</span>)[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #000000; font-weight: bold">or</span> row<span style="color: #333333">.</span>target_surface_act <span style="color: #333333">==</span> <span style="background-color: #fff0f0">&quot;Request&quot;</span>):
        l<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">1</span>
    <span style="color: #008800; font-weight: bold">return</span> l

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">LF_Result_L_L_case3</span>(row):
    l <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
    <span style="color: #008800; font-weight: bold">if</span> row<span style="color: #333333">.</span>source_emitter <span style="color: #333333">==</span> row<span style="color: #333333">.</span>target_emitter <span style="color: #000000; font-weight: bold">and</span> row<span style="color: #333333">.</span>source_addressee <span style="color: #333333">==</span> row<span style="color: #333333">.</span>target_addressee \
    <span style="color: #000000; font-weight: bold">and</span> row<span style="color: #333333">.</span>target_dialogue_act <span style="color: #333333">==</span> <span style="background-color: #fff0f0">&quot;Counteroffer&quot;</span>:
        l<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">1</span>
    <span style="color: #008800; font-weight: bold">return</span> l


<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">LF_Result_L_L_case4</span>(row):
    l <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
    <span style="color: #008800; font-weight: bold">if</span> row<span style="color: #333333">.</span>source_dialogue_act <span style="color: #333333">==</span> <span style="background-color: #fff0f0">&quot;Counteroffer&quot;</span> <span style="color: #000000; font-weight: bold">and</span> row<span style="color: #333333">.</span>target_dialogue_act <span style="color: #333333">==</span> <span style="background-color: #fff0f0">&quot;Refusal&quot;</span>:
        l<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">1</span>
    <span style="color: #008800; font-weight: bold">return</span> l
    
    
</pre></td></tr></table></div>


<hr />

<h3 style="color:#505050">Application of rules to candidates:</h3>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #888888">#1 -- get dialogues</span>
finals <span style="color: #333333">=</span> []
dialogues <span style="color: #333333">=</span> cands<span style="color: #333333">.</span>dialogue_num<span style="color: #333333">.</span>drop_duplicates()
<span style="color: #888888">#dialogues = [103]</span>

<span style="color: #008800; font-weight: bold">for</span> d <span style="color: #000000; font-weight: bold">in</span> tqdm(dialogues):
    
    <span style="color: #888888">#keep track of dus involved in a seq as source or target -- one du cannot be source or target for &gt; 1 rel</span>
    memo_source <span style="color: #333333">=</span> []
    memo_target <span style="color: #333333">=</span> []
 
    <span style="color: #888888"># 2 -- get segment list</span>
    seg_list <span style="color: #333333">=</span> get_seg_list(cands[cands<span style="color: #333333">.</span>dialogue_num <span style="color: #333333">==</span> d])

    <span style="color: #888888"># 3 -- create seg pairs list</span>
    seg_pairs <span style="color: #333333">=</span> []
    <span style="color: #008800; font-weight: bold">for</span> i, s <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(seg_list):
        <span style="color: #008800; font-weight: bold">for</span> n <span style="color: #000000; font-weight: bold">in</span> [j <span style="color: #008800; font-weight: bold">for</span> j <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">reversed</span>(<span style="color: #007020">range</span>((i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">20</span>, i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)) <span style="color: #008800; font-weight: bold">if</span> j<span style="color: #333333">&gt;=</span><span style="color: #0000DD; font-weight: bold">0</span>]:
            <span style="color: #008800; font-weight: bold">try</span>:
                seg_pairs<span style="color: #333333">.</span>append((seg_list[n], seg_list[i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>]))   
            <span style="color: #008800; font-weight: bold">except</span> <span style="color: #FF0000; font-weight: bold">IndexError</span>:
                <span style="color: #008800; font-weight: bold">pass</span>
            
    <span style="color: #888888"># 4 -- for each pair, pull row and append rules</span>

    <span style="color: #008800; font-weight: bold">for</span> s <span style="color: #000000; font-weight: bold">in</span> seg_pairs:
        row <span style="color: #333333">=</span> cands[(cands<span style="color: #333333">.</span>source_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">0</span>]) <span style="color: #333333">&amp;</span> (cands<span style="color: #333333">.</span>target_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">1</span>])]
        <span style="color: #008800; font-weight: bold">if</span> row<span style="color: #333333">.</span>empty:
            <span style="color: #008800; font-weight: bold">continue</span>
        <span style="color: #008800; font-weight: bold">else</span>:
            r_index <span style="color: #333333">=</span> row<span style="color: #333333">.</span>index[<span style="color: #0000DD; font-weight: bold">0</span>]
            row <span style="color: #333333">=</span> row<span style="color: #333333">.</span>iloc[<span style="color: #0000DD; font-weight: bold">0</span>]
            
        <span style="color: #888888">#since we know no Result relations are backwards, eliminate immediately   </span>
        backwards <span style="color: #333333">=</span> cands[(cands<span style="color: #333333">.</span>source_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">1</span>]) <span style="color: #333333">&amp;</span> (cands<span style="color: #333333">.</span>target_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">0</span>])]
        <span style="color: #008800; font-weight: bold">if</span> backwards<span style="color: #333333">.</span>shape[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
            b_index <span style="color: #333333">=</span> backwards<span style="color: #333333">.</span>index[<span style="color: #0000DD; font-weight: bold">0</span>]
            finals<span style="color: #333333">.</span>append((b_index, <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>))
            
        
        <span style="color: #888888">#we only look at ling --&gt; ling cases</span>
        
        <span style="color: #008800; font-weight: bold">if</span> row<span style="color: #333333">.</span>source_type <span style="color: #333333">!=</span> <span style="background-color: #fff0f0">&#39;Segment&#39;</span> <span style="color: #000000; font-weight: bold">or</span> row<span style="color: #333333">.</span>target_type <span style="color: #333333">!=</span> <span style="background-color: #fff0f0">&#39;Segment&#39;</span>:
            
            link <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>  
            
        <span style="color: #008800; font-weight: bold">else</span>: 
            <span style="color: #008800; font-weight: bold">if</span> LF_Result_L_L_case1(row) <span style="color: #000000; font-weight: bold">or</span> LF_Result_L_L_case2(row) <span style="color: #000000; font-weight: bold">or</span> LF_Result_L_L_case3(row) <span style="color: #000000; font-weight: bold">or</span> LF_Result_L_L_case4(row):
            <span style="color: #888888">#if LF_Result_L_L_case1(row) or LF_Result_L_L_case2(row):</span>
                <span style="color: #008800; font-weight: bold">if</span> row<span style="color: #333333">.</span>target_id <span style="color: #000000; font-weight: bold">in</span> memo_target <span style="color: #000000; font-weight: bold">or</span> row<span style="color: #333333">.</span>source_id <span style="color: #000000; font-weight: bold">in</span> memo_source:
                    link <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
                <span style="color: #008800; font-weight: bold">else</span>:
                    link <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">1</span>
                    memo_target<span style="color: #333333">.</span>append(row<span style="color: #333333">.</span>target_id)
                    memo_source<span style="color: #333333">.</span>append(row<span style="color: #333333">.</span>source_id) 
            <span style="color: #008800; font-weight: bold">else</span>:
                link <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
   
                    
        finals<span style="color: #333333">.</span>append((r_index, link))
  
</pre></td></tr></table></div>


<hr />

<hr />
<h2 style="color:#505050">LNL (linguistic source -> non-linguistic target)</h2>
<h3 style="color:#505050">Rule(s):</h3>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">LF_Result_L_NL</span>(row):
    <span style="color: #008800; font-weight: bold">if</span> ( <span style="color: #888888"># Linguistic =&gt; non_linguistic</span>
            ((<span style="background-color: #fff0f0">&quot;addtime&quot;</span> <span style="color: #000000; font-weight: bold">in</span> row<span style="color: #333333">.</span>source_text<span style="color: #333333">.</span>lower() ) <span style="color: #000000; font-weight: bold">and</span> (row<span style="color: #333333">.</span>source_emitter <span style="color: #333333">!=</span> <span style="background-color: #fff0f0">&quot;Server&quot;</span>) 
              <span style="color: #000000; font-weight: bold">and</span> (<span style="background-color: #fff0f0">&quot;this game will expire in&quot;</span> <span style="color: #000000; font-weight: bold">in</span> row<span style="color: #333333">.</span>target_text<span style="color: #333333">.</span>lower()) 
              <span style="color: #000000; font-weight: bold">and</span> ( row<span style="color: #333333">.</span>distance <span style="color: #333333">&lt;=</span> <span style="color: #0000DD; font-weight: bold">3</span> ) )
            
            <span style="color: #000000; font-weight: bold">or</span> ( (<span style="color: #007020">any</span>( x <span style="color: #000000; font-weight: bold">in</span> row<span style="color: #333333">.</span>source_text<span style="color: #333333">.</span>lower() <span style="color: #008800; font-weight: bold">for</span> x <span style="color: #000000; font-weight: bold">in</span> (opinionWords <span style="color: #333333">+</span> [<span style="background-color: #fff0f0">&quot;done&quot;</span>])) ) 
                <span style="color: #000000; font-weight: bold">and</span> endedtheirturn(row<span style="color: #333333">.</span>target_text) 
                <span style="color: #000000; font-weight: bold">and</span> ( row<span style="color: #333333">.</span>distance <span style="color: #333333">&lt;=</span> <span style="color: #0000DD; font-weight: bold">9</span> ) )
            
            <span style="color: #000000; font-weight: bold">or</span> ( (<span style="color: #007020">any</span>( x <span style="color: #000000; font-weight: bold">in</span> row<span style="color: #333333">.</span>source_text<span style="color: #333333">.</span>lower() <span style="color: #008800; font-weight: bold">for</span> x <span style="color: #000000; font-weight: bold">in</span> [<span style="background-color: #fff0f0">&quot;start&quot;</span>, <span style="background-color: #fff0f0">&quot;sit&quot;</span>, <span style="background-color: #fff0f0">&quot;ready&quot;</span>]) ) 
                <span style="color: #000000; font-weight: bold">and</span> gamestarted(row<span style="color: #333333">.</span>target_text) 
                <span style="color: #000000; font-weight: bold">and</span> ( row<span style="color: #333333">.</span>distance <span style="color: #333333">&lt;=</span> <span style="color: #0000DD; font-weight: bold">6</span> ) )
        ):
            l<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">1</span>
    <span style="color: #008800; font-weight: bold">else</span>:
            l<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>
    <span style="color: #008800; font-weight: bold">return</span> l
</pre></td></tr></table></div>


<hr />
<h3 style="color:#505050">Application of rules to candidates:</h3>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #888888">#1 -- get dialogues</span>
finals <span style="color: #333333">=</span> []
dialogues <span style="color: #333333">=</span> cands<span style="color: #333333">.</span>dialogue_num<span style="color: #333333">.</span>drop_duplicates()

<span style="color: #008800; font-weight: bold">for</span> d <span style="color: #000000; font-weight: bold">in</span> tqdm(dialogues):
 
    <span style="color: #888888"># 2 -- get segment list</span>
    seg_list <span style="color: #333333">=</span> get_seg_list(cands[cands<span style="color: #333333">.</span>dialogue_num <span style="color: #333333">==</span> d])

    <span style="color: #888888"># 3 -- create seg pairs list</span>
    seg_pairs <span style="color: #333333">=</span> []
    <span style="color: #008800; font-weight: bold">for</span> i, s <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(seg_list):
        <span style="color: #008800; font-weight: bold">for</span> n <span style="color: #000000; font-weight: bold">in</span> [j <span style="color: #008800; font-weight: bold">for</span> j <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">reversed</span>(<span style="color: #007020">range</span>((i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">20</span>, i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)) <span style="color: #008800; font-weight: bold">if</span> j<span style="color: #333333">&gt;=</span><span style="color: #0000DD; font-weight: bold">0</span>]:
            <span style="color: #008800; font-weight: bold">try</span>:
                seg_pairs<span style="color: #333333">.</span>append((seg_list[n], seg_list[i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>]))   
            <span style="color: #008800; font-weight: bold">except</span> <span style="color: #FF0000; font-weight: bold">IndexError</span>:
                <span style="color: #008800; font-weight: bold">pass</span>
            
    <span style="color: #888888"># 4 -- for each pair, pull row and append rules</span>

    <span style="color: #008800; font-weight: bold">for</span> s <span style="color: #000000; font-weight: bold">in</span> seg_pairs:
        row <span style="color: #333333">=</span> cands[(cands<span style="color: #333333">.</span>source_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">0</span>]) <span style="color: #333333">&amp;</span> (cands<span style="color: #333333">.</span>target_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">1</span>])]
        <span style="color: #008800; font-weight: bold">if</span> row<span style="color: #333333">.</span>empty:
            <span style="color: #008800; font-weight: bold">continue</span>
        <span style="color: #008800; font-weight: bold">else</span>:
            r_index <span style="color: #333333">=</span> row<span style="color: #333333">.</span>index[<span style="color: #0000DD; font-weight: bold">0</span>]
            row <span style="color: #333333">=</span> row<span style="color: #333333">.</span>iloc[<span style="color: #0000DD; font-weight: bold">0</span>]
        
        <span style="color: #888888"># make sure that if any backwards links exist they are also 0</span>
            
        backwards <span style="color: #333333">=</span> cands[(cands<span style="color: #333333">.</span>source_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">1</span>]) <span style="color: #333333">&amp;</span> (cands<span style="color: #333333">.</span>target_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">0</span>])]
        <span style="color: #008800; font-weight: bold">if</span> backwards<span style="color: #333333">.</span>shape[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
            b_index <span style="color: #333333">=</span> backwards<span style="color: #333333">.</span>index[<span style="color: #0000DD; font-weight: bold">0</span>]
            finals<span style="color: #333333">.</span>append((b_index, <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>))
            
        
        <span style="color: #888888">#we only look at ling --&gt; ling cases</span>
        
        <span style="color: #008800; font-weight: bold">if</span> row<span style="color: #333333">.</span>source_type <span style="color: #333333">!=</span> <span style="background-color: #fff0f0">&#39;Segment&#39;</span> <span style="color: #000000; font-weight: bold">or</span> row<span style="color: #333333">.</span>target_type <span style="color: #333333">!=</span> <span style="background-color: #fff0f0">&#39;NonplayerSegment&#39;</span>:
            
            link <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>  
            
        <span style="color: #008800; font-weight: bold">else</span>: 
        
            link_one <span style="color: #333333">=</span> LF_Result_L_NL(row)
            
            <span style="color: #008800; font-weight: bold">if</span> link_one:
                
                link <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">1</span>
                
            <span style="color: #008800; font-weight: bold">else</span>:
                
                link <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
   
                    
        finals<span style="color: #333333">.</span>append((r_index, link))
                
</pre></td></tr></table></div>


<hr />
<h2 style="color:#505050">NLL (non-linguistic source -> linguistic target)</h2>
<h3 style="color:#505050">Rule(s):</h3>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">LF_Result_NL_L</span>(row):
    <span style="color: #888888">#non-ling --&gt; ling</span>
    <span style="color: #008800; font-weight: bold">if</span> (<span style="background-color: #fff0f0">&quot;type *addtime* to extend this game another&quot;</span> <span style="color: #000000; font-weight: bold">in</span> row<span style="color: #333333">.</span>source_text<span style="color: #333333">.</span>lower()) \
    <span style="color: #000000; font-weight: bold">and</span> (<span style="background-color: #fff0f0">&quot;addtime&quot;</span> <span style="color: #000000; font-weight: bold">in</span> row<span style="color: #333333">.</span>target_text<span style="color: #333333">.</span>lower()):
         l<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">1</span>
    <span style="color: #008800; font-weight: bold">else</span>:
         l<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>
    <span style="color: #008800; font-weight: bold">return</span> l
</pre></td></tr></table></div>


<hr />
<h3 style="color:#505050">Application of rules to candidates:</h3>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #888888">#1 -- get dialogues</span>
finals <span style="color: #333333">=</span> []
dialogues <span style="color: #333333">=</span> cands<span style="color: #333333">.</span>dialogue_num<span style="color: #333333">.</span>drop_duplicates()

<span style="color: #008800; font-weight: bold">for</span> d <span style="color: #000000; font-weight: bold">in</span> tqdm(dialogues):
 
    <span style="color: #888888"># 2 -- get segment list</span>
    seg_list <span style="color: #333333">=</span> get_seg_list(cands[cands<span style="color: #333333">.</span>dialogue_num <span style="color: #333333">==</span> d])

    <span style="color: #888888"># 3 -- create seg pairs list</span>
    seg_pairs <span style="color: #333333">=</span> []
    <span style="color: #008800; font-weight: bold">for</span> i, s <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(seg_list):
        <span style="color: #008800; font-weight: bold">for</span> n <span style="color: #000000; font-weight: bold">in</span> [j <span style="color: #008800; font-weight: bold">for</span> j <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">reversed</span>(<span style="color: #007020">range</span>((i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">20</span>, i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)) <span style="color: #008800; font-weight: bold">if</span> j<span style="color: #333333">&gt;=</span><span style="color: #0000DD; font-weight: bold">0</span>]:
            <span style="color: #008800; font-weight: bold">try</span>:
                seg_pairs<span style="color: #333333">.</span>append((seg_list[n], seg_list[i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>]))   
            <span style="color: #008800; font-weight: bold">except</span> <span style="color: #FF0000; font-weight: bold">IndexError</span>:
                <span style="color: #008800; font-weight: bold">pass</span>
            
    <span style="color: #888888"># 4 -- for each pair, pull row and append rules</span>

    <span style="color: #008800; font-weight: bold">for</span> s <span style="color: #000000; font-weight: bold">in</span> seg_pairs:
        row <span style="color: #333333">=</span> cands[(cands<span style="color: #333333">.</span>source_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">0</span>]) <span style="color: #333333">&amp;</span> (cands<span style="color: #333333">.</span>target_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">1</span>])]
        <span style="color: #008800; font-weight: bold">if</span> row<span style="color: #333333">.</span>empty:
            <span style="color: #008800; font-weight: bold">continue</span>
        <span style="color: #008800; font-weight: bold">else</span>:
            r_index <span style="color: #333333">=</span> row<span style="color: #333333">.</span>index[<span style="color: #0000DD; font-weight: bold">0</span>]
            row <span style="color: #333333">=</span> row<span style="color: #333333">.</span>iloc[<span style="color: #0000DD; font-weight: bold">0</span>]
        
        <span style="color: #888888"># make sure that if any backwards links exist they are also 0</span>
            
        backwards <span style="color: #333333">=</span> cands[(cands<span style="color: #333333">.</span>source_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">1</span>]) <span style="color: #333333">&amp;</span> (cands<span style="color: #333333">.</span>target_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">0</span>])]
        <span style="color: #008800; font-weight: bold">if</span> backwards<span style="color: #333333">.</span>shape[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
            b_index <span style="color: #333333">=</span> backwards<span style="color: #333333">.</span>index[<span style="color: #0000DD; font-weight: bold">0</span>]
            finals<span style="color: #333333">.</span>append((b_index, <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>))
            
        
        <span style="color: #888888">#we only look at ling --&gt; ling cases</span>
        
        <span style="color: #008800; font-weight: bold">if</span> row<span style="color: #333333">.</span>source_type <span style="color: #333333">!=</span> <span style="background-color: #fff0f0">&#39;NonplayerSegment&#39;</span> <span style="color: #000000; font-weight: bold">or</span> row<span style="color: #333333">.</span>target_type <span style="color: #333333">!=</span> <span style="background-color: #fff0f0">&#39;Segment&#39;</span>:
            
            link <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>  
            
        <span style="color: #008800; font-weight: bold">else</span>: 
        
            link_one <span style="color: #333333">=</span> LF_Result_NL_L(row)
            
            <span style="color: #008800; font-weight: bold">if</span> link_one:
                
                link <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">1</span>
                
            <span style="color: #008800; font-weight: bold">else</span>:
                
                link <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
   
                    
        finals<span style="color: #333333">.</span>append((r_index, link))
                
</pre></td></tr></table></div>

<hr />
<h2 style="color:#505050">NLNL (non-linguistic source -> non-linguistic target)</h2>
<h3 style="color:#505050">Rule(s):</h3>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">LF_Res_NL_NL_case1</span>(row):
    l<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>
    <span style="color: #008800; font-weight: bold">if</span> (endedtheirturn(row<span style="color: #333333">.</span>source_text) <span style="color: #000000; font-weight: bold">and</span> itsXsTurnToRollTheDice(row<span style="color: #333333">.</span>target_text)) \
    <span style="color: #000000; font-weight: bold">or</span> (itsXsTurnToRollTheDice(row<span style="color: #333333">.</span>source_text) <span style="color: #000000; font-weight: bold">and</span> rolled(row<span style="color: #333333">.</span>target_text)) \
    <span style="color: #000000; font-weight: bold">or</span> (willMoveTheRobber(row<span style="color: #333333">.</span>source_text) <span style="color: #000000; font-weight: bold">and</span> (stoleAResourceFrom(row<span style="color: #333333">.</span>target_text) <span style="color: #000000; font-weight: bold">or</span> movedRobber(row<span style="color: #333333">.</span>target_text))) \
    <span style="color: #000000; font-weight: bold">or</span> (needsToDiscard(row<span style="color: #333333">.</span>source_text) <span style="color: #000000; font-weight: bold">and</span> discardedXresources(row<span style="color: #333333">.</span>target_text)) \
    <span style="color: #000000; font-weight: bold">or</span> (rolled(row<span style="color: #333333">.</span>source_text) <span style="color: #000000; font-weight: bold">and</span> (get(row<span style="color: #333333">.</span>target_text) <span style="color: #000000; font-weight: bold">or</span> needsToDiscard(row<span style="color: #333333">.</span>target_text) <span style="color: #000000; font-weight: bold">or</span> noplayergetsanyt(row<span style="color: #333333">.</span>target_text) <span style="color: #000000; font-weight: bold">or</span> willMoveTheRobber(row<span style="color: #333333">.</span>target_text))) \
    <span style="color: #000000; font-weight: bold">or</span> (XplayedAPCard(row<span style="color: #333333">.</span>source_text) <span style="color: #000000; font-weight: bold">and</span> (movedRobber(row<span style="color: #333333">.</span>target_text) <span style="color: #000000; font-weight: bold">or</span> willMoveTheRobber(row<span style="color: #333333">.</span>target_text) <span style="color: #000000; font-weight: bold">or</span> received(row<span style="color: #333333">.</span>target_text))) \
    <span style="color: #000000; font-weight: bold">or</span> (itsXsTurnToBuildP(row<span style="color: #333333">.</span>source_text) <span style="color: #000000; font-weight: bold">and</span> XBuiltaP(row<span style="color: #333333">.</span>target_text)) \
    <span style="color: #000000; font-weight: bold">or</span> (discardedXresources(row<span style="color: #333333">.</span>source_text) <span style="color: #000000; font-weight: bold">and</span> (movedRobber(row<span style="color: #333333">.</span>target_text) <span style="color: #000000; font-weight: bold">or</span> willMoveTheRobber(row<span style="color: #333333">.</span>target_text))) \
    <span style="color: #000000; font-weight: bold">or</span> (movedRobber(row<span style="color: #333333">.</span>source_text) <span style="color: #000000; font-weight: bold">and</span> stoleAResourceFrom(row<span style="color: #333333">.</span>target_text)) \
    <span style="color: #000000; font-weight: bold">or</span> (traded(row<span style="color: #333333">.</span>source_text) <span style="color: #000000; font-weight: bold">and</span> XBuiltaP(row<span style="color: #333333">.</span>target_text)) \
    <span style="color: #000000; font-weight: bold">or</span> (XBuiltaP(row<span style="color: #333333">.</span>source_text) <span style="color: #000000; font-weight: bold">and</span> itsXsTurnToBuildP(row<span style="color: #333333">.</span>source_text)):
        l<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">1</span>
    
    <span style="color: #008800; font-weight: bold">return</span> l

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">LF_Res_NL_NL_case2</span>(row):
    <span style="color: #888888">#dealing with CDUs</span>
    l<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>
    <span style="color: #008800; font-weight: bold">if</span> noplayergetsanyt(row<span style="color: #333333">.</span>source_text) <span style="color: #000000; font-weight: bold">and</span> has_resources(row<span style="color: #333333">.</span>target_text) <span style="color: #000000; font-weight: bold">and</span> is_head(cands, row<span style="color: #333333">.</span>target_turn_id, row<span style="color: #333333">.</span>target_span_end, <span style="background-color: #fff0f0">&quot;target&quot;</span>):
        l<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">1</span>
    <span style="color: #008800; font-weight: bold">elif</span> get(row<span style="color: #333333">.</span>source_text) <span style="color: #000000; font-weight: bold">and</span> has_resources(row<span style="color: #333333">.</span>target_text) <span style="color: #000000; font-weight: bold">and</span> is_head(cands, row<span style="color: #333333">.</span>source_turn_id, row<span style="color: #333333">.</span>source_span_end) \
    <span style="color: #000000; font-weight: bold">and</span> is_head(cands, row<span style="color: #333333">.</span>target_turn_id, row<span style="color: #333333">.</span>target_span_end, <span style="background-color: #fff0f0">&quot;target&quot;</span>):
        l<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">1</span>
    <span style="color: #008800; font-weight: bold">return</span> l
</pre></td></tr></table></div>

<hr />
<h3 style="color:#505050">Application of rules to candidates:</h3>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #888888">#1 -- get dialogues</span>
finals <span style="color: #333333">=</span> []
dialogues <span style="color: #333333">=</span> cands<span style="color: #333333">.</span>dialogue_num<span style="color: #333333">.</span>drop_duplicates()

<span style="color: #008800; font-weight: bold">for</span> d <span style="color: #000000; font-weight: bold">in</span> tqdm(dialogues):
    
    memo_source <span style="color: #333333">=</span> []
    memo_target <span style="color: #333333">=</span> []
 
    <span style="color: #888888"># 2 -- get segment list</span>
    seg_list <span style="color: #333333">=</span> get_seg_list(cands[cands<span style="color: #333333">.</span>dialogue_num <span style="color: #333333">==</span> d])

    <span style="color: #888888"># 3 -- create seg pairs list</span>
    seg_pairs <span style="color: #333333">=</span> []
    <span style="color: #008800; font-weight: bold">for</span> i, s <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(seg_list):
        <span style="color: #008800; font-weight: bold">for</span> n <span style="color: #000000; font-weight: bold">in</span> [j <span style="color: #008800; font-weight: bold">for</span> j <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">reversed</span>(<span style="color: #007020">range</span>((i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">20</span>, i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)) <span style="color: #008800; font-weight: bold">if</span> j<span style="color: #333333">&gt;=</span><span style="color: #0000DD; font-weight: bold">0</span>]:
            <span style="color: #008800; font-weight: bold">try</span>:
                seg_pairs<span style="color: #333333">.</span>append((seg_list[n], seg_list[i<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>]))   
            <span style="color: #008800; font-weight: bold">except</span> <span style="color: #FF0000; font-weight: bold">IndexError</span>:
                <span style="color: #008800; font-weight: bold">pass</span>
            
    <span style="color: #888888"># 4 -- for each pair, pull row and append rules</span>

    <span style="color: #008800; font-weight: bold">for</span> s <span style="color: #000000; font-weight: bold">in</span> seg_pairs:
        row <span style="color: #333333">=</span> cands[(cands<span style="color: #333333">.</span>source_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">0</span>]) <span style="color: #333333">&amp;</span> (cands<span style="color: #333333">.</span>target_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">1</span>])]
        <span style="color: #008800; font-weight: bold">if</span> row<span style="color: #333333">.</span>empty:
            <span style="color: #008800; font-weight: bold">continue</span>
        <span style="color: #008800; font-weight: bold">else</span>:
            r_index <span style="color: #333333">=</span> row<span style="color: #333333">.</span>index[<span style="color: #0000DD; font-weight: bold">0</span>]
            row <span style="color: #333333">=</span> row<span style="color: #333333">.</span>iloc[<span style="color: #0000DD; font-weight: bold">0</span>]
        
        <span style="color: #888888"># make sure that if any backwards links exist they are also 0</span>
            
        backwards <span style="color: #333333">=</span> cands[(cands<span style="color: #333333">.</span>source_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">1</span>]) <span style="color: #333333">&amp;</span> (cands<span style="color: #333333">.</span>target_id <span style="color: #333333">==</span> s[<span style="color: #0000DD; font-weight: bold">0</span>])]
        <span style="color: #008800; font-weight: bold">if</span> backwards<span style="color: #333333">.</span>shape[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
            b_index <span style="color: #333333">=</span> backwards<span style="color: #333333">.</span>index[<span style="color: #0000DD; font-weight: bold">0</span>]
            finals<span style="color: #333333">.</span>append((b_index, <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>))
            
        
        <span style="color: #888888">#we only look at ling --&gt; ling cases</span>
        
        <span style="color: #008800; font-weight: bold">if</span> row<span style="color: #333333">.</span>source_type <span style="color: #333333">!=</span> <span style="background-color: #fff0f0">&#39;NonplayerSegment&#39;</span> <span style="color: #000000; font-weight: bold">or</span> row<span style="color: #333333">.</span>target_type <span style="color: #333333">!=</span> <span style="background-color: #fff0f0">&#39;NonplayerSegment&#39;</span>:
            
            link <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>  
            
        <span style="color: #008800; font-weight: bold">else</span>: 
            <span style="color: #008800; font-weight: bold">if</span> LF_Res_NL_NL_case2(row) <span style="color: #000000; font-weight: bold">or</span> LF_Res_NL_NL_case1(row):
            <span style="color: #888888">#if LF_Res_NL_NL_case2(row) or LF_Res_NL_NL_case1(row):</span>
                <span style="color: #008800; font-weight: bold">if</span> row<span style="color: #333333">.</span>target_id <span style="color: #000000; font-weight: bold">in</span> memo_target <span style="color: #000000; font-weight: bold">or</span> row<span style="color: #333333">.</span>source_id <span style="color: #000000; font-weight: bold">in</span> memo_source:
                    link <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
                <span style="color: #008800; font-weight: bold">else</span>:
                    link <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">1</span>
                    memo_target<span style="color: #333333">.</span>append(row<span style="color: #333333">.</span>target_id)
                    memo_source<span style="color: #333333">.</span>append(row<span style="color: #333333">.</span>source_id)   
            <span style="color: #008800; font-weight: bold">else</span>:
                link <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
                           
        finals<span style="color: #333333">.</span>append((r_index, link))
                
</pre></td></tr></table></div>

<hr />

</body>
</html>

